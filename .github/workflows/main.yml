name: Gmail Validator

on:
  schedule:
    - cron: '0 8 * * *'   # Run daily at 08:00 UTC
    - cron: '0 9 * * *'   # Run daily at 09:00 UTC

jobs:
  validate-emails:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up PHP with IMAP and required extensions
      run: |
        sudo apt-get update
        sudo apt-get install -y php php-cli php-curl php-mbstring php-imap php-xml php-zip unzip
        sudo php -m | grep imap

    - name: Run gmail.php
      run: php gmail.php

    - name: Run validator.php
      run: php validator.php

    - name: Run delete.php
      run: php delete.php

    - name: Commit and push valid_emails.txt
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add valid_emails.txt
        git commit -m "Update valid_emails.txt [auto-run]"
        git push
      env:
        GIT_AUTHOR_NAME: github-actions
        GIT_AUTHOR_EMAIL: github-actions@github.com
        GIT_COMMITTER_NAME: github-actions
        GIT_COMMITTER_EMAIL: github-actions@github.com
